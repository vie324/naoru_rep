# 🖥️ バックエンドサーバー セットアップガイド（初心者向け）

## 📋 目次

1. [必要なもの](#必要なもの)
2. [方法1: 簡易版サーバー（推奨・初心者向け）](#方法1-簡易版サーバー推奨初心者向け)
3. [方法2: 完全版サーバー（上級者向け）](#方法2-完全版サーバー上級者向け)
4. [方法3: Dockerを使う](#方法3-dockerを使う)
5. [トラブルシューティング](#トラブルシューティング)

---

## 必要なもの

✅ **Node.js** がインストールされていること

### Node.jsのインストール確認

ターミナル（コマンドプロンプト）を開いて：

```bash
node --version
```

`v18.0.0` 以上が表示されればOK！

表示されない場合は、[Node.js公式サイト](https://nodejs.org/)からインストールしてください（LTS版を推奨）。

---

## 方法1: 簡易版サーバー（推奨・初心者向け）

**🎯 特徴：**
- ✅ インストールが簡単（5分以内）
- ✅ Puppeteerなし（軽量）
- ✅ APIエンドポイントのみ提供
- ⚠️ 実際のスクレイピングは動作しません（デモデータを返却）

### ステップ1: 簡易版サーバーファイルを作成

プロジェクトフォルダで以下を実行：

```bash
cd backend
```

新しいファイル `server-lite.js` を作成します（後述）。

### ステップ2: インストール

```bash
npm init -y
npm install express cors
```

### ステップ3: 起動

```bash
node server-lite.js
```

### ステップ4: 確認

ブラウザで http://localhost:3001/health を開く

✅ `{"status":"ok"}` が表示されれば成功！

---

## 方法2: 完全版サーバー（上級者向け）

**🎯 特徴：**
- ✅ 実際のスクレイピングが動作
- ✅ 本番環境に近い
- ⚠️ インストールに時間がかかる（10-20分）
- ⚠️ Chromiumの自動ダウンロードが必要

### ステップ1: package.jsonの確認

`backend/package.json` が存在することを確認。

### ステップ2: インストール

```bash
cd backend
npm install
```

**注意**: Puppeteerのインストール中、Chromiumが自動ダウンロードされます。
これには数分かかる場合があります。

### ステップ3: 起動

```bash
npm start
```

### ステップ4: 確認

ブラウザで http://localhost:3001/health を開く

---

## 方法3: Dockerを使う

**🎯 特徴：**
- ✅ 環境に依存しない
- ✅ 本番環境と同じ
- ⚠️ Dockerのインストールが必要

### ステップ1: Dockerfileを作成

`backend/Dockerfile` を作成（後述）。

### ステップ2: イメージをビルド

```bash
cd backend
docker build -t naoru-backend .
```

### ステップ3: コンテナを起動

```bash
docker run -p 3001:3001 naoru-backend
```

### ステップ4: 確認

ブラウザで http://localhost:3001/health を開く

---

## 🚀 フロントエンドとの接続確認

### 1. サーバーが起動している状態で

### 2. index.htmlをブラウザで開く

### 3. 「競合分析」タブを開く

### 4. エリアに「渋谷」と入力して「競合を検索」

✅ デモモードのメッセージが**消えて**、実データ（またはエラー）が表示されれば成功！

---

## トラブルシューティング

### Q1: `npm: command not found`

**A**: Node.jsがインストールされていません。
→ [Node.js公式サイト](https://nodejs.org/)からインストール

### Q2: `Error: Cannot find module 'express'`

**A**: 依存関係がインストールされていません。
```bash
cd backend
npm install
```

### Q3: `Error: Failed to launch the browser process!`

**A**: Puppeteerの問題です。簡易版サーバー（方法1）を使ってください。

### Q4: `Port 3001 is already in use`

**A**: 他のアプリが3001ポートを使用しています。
```bash
# ポートを変更（server.jsまたはserver-lite.jsを編集）
const PORT = 3002; // 3001から3002に変更
```

### Q5: フロントエンドで「Failed to fetch」エラーが出る

**A**: サーバーが起動していません。
1. ターミナルでサーバーが動いているか確認
2. http://localhost:3001/health をブラウザで開いて確認

### Q6: CORS エラーが出る

**A**: すでに対策済みですが、念のため確認：
- サーバーコードに `app.use(cors());` があるか
- ブラウザのコンソールでエラー詳細を確認

---

## 📊 各方法の比較

| 項目 | 簡易版 | 完全版 | Docker |
|------|-------|-------|--------|
| **セットアップ時間** | ⭐⭐⭐ 5分 | ⭐⭐ 15分 | ⭐ 20分 |
| **難易度** | ⭐⭐⭐ 簡単 | ⭐⭐ 中級 | ⭐ 上級 |
| **スクレイピング** | ❌ デモのみ | ✅ 動作 | ✅ 動作 |
| **初心者向け** | ✅ 推奨 | △ 可能 | ❌ 非推奨 |

---

## 🎯 推奨フロー

### 初心者の場合

1. **まず簡易版サーバーを試す**（方法1）
2. 動作確認できたら満足
3. 本格的なスクレイピングが必要になったら完全版を検討

### 開発者の場合

1. 完全版サーバーを直接セットアップ（方法2）
2. 問題があればDockerを検討（方法3）

---

## ✨ まとめ

**初心者には「簡易版サーバー」を強く推奨します！**

理由：
- ✅ セットアップが超簡単
- ✅ 依存関係が少ない
- ✅ すぐに動作確認できる
- ✅ デモデータで機能を理解できる

**次のセクションで簡易版サーバーのコードを提供します！** 👇
